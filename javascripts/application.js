// Generated by CoffeeScript 1.3.3
(function() {
  var backHome, duration, homeLinks, initializePosition, scale, sizeHome, xImage, xLast, yImage, yLast, _centerStageOn, _positionStageOn;

  duration = 1000;

  scale = 1;

  xLast = 0;

  yLast = 0;

  xImage = 0;

  yImage = 0;

  $(function() {
    sizeHome();
    homeLinks();
    backHome();
    return $("body").click(function() {
      return doctypeZoom(2);
    });
  });

  sizeHome = function() {
    $("#home").outerWidth($(window).width());
    return $("#home").outerHeight($(window).height());
  };

  initializePosition = function() {
    return _centerStageOn($("#home"));
  };

  homeLinks = function() {
    return $("body").on("click", "#home ul a", function(e) {
      var target;
      e.preventDefault();
      target = $(e.target).data("target");
      $("#home .return-home").show();
      return _positionStageOn($("#" + target));
    });
  };

  backHome = function() {
    return $("body").on("click", ".return-home", function(e) {
      $("#home .return-home").hide();
      return $("#stage").removeClass("zoomed-out");
    });
  };

  jQuery.fn.transformOrigin = function(x, y) {
    var str;
    str = "" + x + "px " + y + "px";
    str = "" + x + "% " + y + "%";
    return $(this).css({
      "-webkit-transform-origin": "" + str,
      "-moz-transform-origin": "" + str,
      "-ms-transform-origin": "" + str,
      "-o-transform-origin": "" + str,
      "transform-origin": "" + str
    });
  };

  jQuery.fn.centerCoords = function() {
    var left, pos, top;
    pos = $(this).position();
    top = $(this).outerHeight() / 2 + pos.top;
    left = $(this).outerWidth() / 2 + pos.left;
    top = (top * 100) / $("#stage").height();
    left = (left * 100) / $("#stage").width();
    return {
      top: top,
      left: left
    };
  };

  _centerStageOn = function(el) {
    var elCoords;
    elCoords = $(el).centerCoords();
    return $("#stage").transformOrigin(elCoords.left, elCoords.top);
  };

  _positionStageOn = function(el) {
    var pos;
    pos = $(el).position();
    return $("#stage").css({
      top: pos.top * -1 + ($(window).height() - el.outerHeight()) / 2,
      left: pos.left * -1 + ($(window).width() - el.outerWidth()) / 2
    });
  };

  window.doctypeZoom = function(delta) {
    var max, min, xNew, xScreen, yNew, yScreen;
    xScreen = $("#home").position().left + $("#home").outerWidth() / 2 - $("#stage").offset().left * 2;
    yScreen = $("#home").position().top + $("#home").outerHeight() / 2 - $("#stage").offset().top * 2;
    console.log("screen:", xScreen, yScreen);
    xImage = xImage + ((xScreen - xLast) / scale);
    yImage = yImage + ((yScreen - yLast) / scale);
    console.log("image:", xImage, yImage);
    if (delta > 0) {
      scale *= 2;
    } else {
      scale /= 2;
    }
    min = 0.15;
    max = 4;
    scale = scale < min ? min : (scale > max ? max : scale);
    xNew = (xScreen - xImage) / scale;
    yNew = (yScreen - yImage) / scale;
    xLast = xScreen;
    yLast = yScreen;
    console.log("new:", xNew, yNew, scale);
    $("#stage").transform("scale(" + scale + ") translate(" + xNew + "px, " + yNew + "px)");
    return $("#stage").transformOrigin("" + xImage + "px " + yImage + "px");
  };

  jQuery.fn.transform = function(args) {
    return $(this).css({
      "-webkit-transform": args,
      "-moz-transform": args,
      "transform": args
    });
  };

  jQuery.fn.transformOrigin = function(args) {
    return $(this).css({
      "-webkit-transform-origin": args,
      "-moz-transform-origin": args,
      "-ms-transform-origin": args,
      "-o-transform-origin": args,
      "transform-origin": args
    });
  };

}).call(this);
